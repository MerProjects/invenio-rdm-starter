{
	auto_https off
	log {
		level DEBUG
	}
}
:8080 {
	route {
		@posts path /posts/*
		@lang path /en/* /de/* /es/* /fr/* /it/* /pt/* /tr/*
		@legacy path /about /board
		@query query p=* q=*

		# redirect Rogue Scholar legacy URLs
		redir @posts https://legacy.rogue-scholar.org{uri}
		redir @lang https://legacy.rogue-scholar.org{uri}
		redir @legacy https://legacy.rogue-scholar.org{uri}

		uri replace /en /
		uri replace /de /
		uri replace /es /
		uri replace /fr /
		uri replace /it /
		uri replace /pt /
		uri replace /tr /
		uri replace /posts /
		uri replace /blogs /communities
		uri replace /blogs/* /communities/*

		uri query query>q
		uri query page>p
		uri query -category
		uri query -generator
		uri query -tags
		uri query -language

		reverse_proxy 2a09:8280:1::39:a377:0 {
			header_up Host beta.rogue-scholar.org
		}
	}
}
