localhost :443 {
	# redirect legacy URLs
	@blogs path /blogs /blogs/*
	@posts path /posts /posts/*
	@lang path /en /en/* /de /de/* /es /es/* /fr /fr/* /it /it/* /pt /pt/* /tr /tr/*

	redir @blogs https://legacy.rogue-scholar.org{uri}
	redir @posts https://legacy.rogue-scholar.org{uri}
	redir @lang https://legacy.rogue-scholar.org{uri}

	root /static/* /opt/invenio/var/instance/static
	try_files {path} {path}/ /index.html
	reverse_proxy web:5000
	file_server
	encode gzip
}

:6000 {
	# redirect legacy URLs
	@blogs path /blogs /blogs/*
	@posts path /posts /posts/*
	@lang path /en /en/* /de /de/* /es /es/* /fr /fr/* /it /it/* /pt /pt/* /tr /tr/*

	redir @blogs https://legacy.rogue-scholar.org{uri}
	redir @posts https://legacy.rogue-scholar.org{uri}
	redir @lang https://legacy.rogue-scholar.org{uri}

	# requests get proxied to the backend server
	reverse_proxy 0.0.0.0:5000
}
